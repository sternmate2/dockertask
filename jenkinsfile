pipeline {
    agent any

    // environment {
    //     JFROG_USER     = credentials('Jfrog_user')
    //     jFROG_PASS = credentials('Jfrog_password')
    //     ARM_CLIENT_ID: ${{ secrets.AZURE_AD_CLIENT_ID }} 
    //     ARM_CLIENT_SECRET: ${{ secrets.AZURE_AD_CLIENT_SECRET }} 
    //     ARM_TENANT_ID: ${{ secrets.AZURE_TENANTID }} 
    //     ARM_SUBSCRIPTION_ID: ${{ secrets.AZURE_SUBSCRIPTIONID }}
    
    // }

    stages {
        
        // stage('build docker image') {
        //     steps {

        //         sh "docker build -t test ."
        //     }
        // }
        // stage('Azure login + build image') {
        //     steps {
        //         withCredentials([azureServicePrincipal('AZURE_CRED')]) {
        //             sh 'az login --service-principal -u $AZURE_CLIENT_ID -p $AZURE_CLIENT_SECRET -t $AZURE_TENANT_ID'
        //             sh 'az account set -s $AZURE_SUBSCRIPTION_ID'
        //             sh 'az acr login --name shaharRG --resource-group ShaharTF'
        //             sh 'az acr build --image shaharrg.azurecr.io/test:lts --registry shaharRG --file Dockerfile . '
         
        //         }
        //     }
        // }    

        // stage('Run Ansible'){
        //     steps {
        //         ansiblePlaybook colorized: true, credentialsId: 'root-production', disableHostKeyChecking: true, inventory: 'myinventory', playbook: 'myplaybook.yml', tags: 'mytag'

        stage('Deploy with ansible ') {
            steps {
                ansiblePlaybook(
                        become: true,
                        colorized: true,
                        credentialsId: 'ssh_pk',
                            disableHostKeyChecking: true,
                            installation: 'ansible',
                            playbook: 'ansible/testplaybook.yml',
                            inventory   : 'ansible/inventory/prod.yml',
                            extras: '-vvv'
                    )
            }
        }




        // stage('ansible istalling dotnet on remote') {
        //     steps {
        //         dir("ansible") {
        //             sh "ansible-galaxy install -r requirements.yml"
        //             sh """ ansible-playbook testplaybook.yml -i inventory/prod.yml -u shahars --private-key "/home/jenkins/.ssh/id_rsa" """
        //         }
        //     }
        // }

        // stage('Deploy') {
        //     withCredentials([azureServicePrincipal('principal-credentials-id')]) {
        //     sh 'az login --service-principal -u $AZURE_CLIENT_ID -p $AZURE_CLIENT_SECRET -t $AZURE_TENANT_ID'
        //     sh 'az account set -s $AZURE_SUBSCRIPTION_ID'
        //     sh 'az resource list'
        //     }
        // }











    }
}