pipeline {
    agent any

    // environment {
    //     JFROG_USER     = credentials('Jfrog_user')
    //     jFROG_PASS = credentials('Jfrog_password')
    //     ARM_CLIENT_ID: ${{ secrets.AZURE_AD_CLIENT_ID }} 
    //     ARM_CLIENT_SECRET: ${{ secrets.AZURE_AD_CLIENT_SECRET }} 
    //     ARM_TENANT_ID: ${{ secrets.AZURE_TENANTID }} 
    //     ARM_SUBSCRIPTION_ID: ${{ secrets.AZURE_SUBSCRIPTIONID }}
    
    // }

    stages {
        
        stage('build docker image') {
            steps {

                sh "sudo docker build -t test ."
            }
        }
        stage('Azure login + build image') {
            steps {
                withCredentials([azureServicePrincipal('AZURE_CRED')]) {
                    sh 'az login --service-principal -u $AZURE_CLIENT_ID -p $AZURE_CLIENT_SECRET -t $AZURE_TENANT_ID'
                    sh 'az account set -s $AZURE_SUBSCRIPTION_ID'
                    sh 'az acr login --name shaharRG --resource-group ShaharTF'
                    sh 'az acr build --image shaharrg.azurecr.io/test:lts --registry shaharRG --file Dockerfile . '
         
                }
            }
        }    


        // stage('Deploy') {
        //     withCredentials([azureServicePrincipal('principal-credentials-id')]) {
        //     sh 'az login --service-principal -u $AZURE_CLIENT_ID -p $AZURE_CLIENT_SECRET -t $AZURE_TENANT_ID'
        //     sh 'az account set -s $AZURE_SUBSCRIPTION_ID'
        //     sh 'az resource list'
        //     }
        // }











    }
}